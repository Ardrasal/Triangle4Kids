{% extends 'base.html' %} 
{% block title %}
Homepage - {{ block.super }} 
{% endblock title %}

{% block content %}
<!--===================================
=            Header           =
====================================-->


{% comment %} <section >
	<div class="container">
		<div class="row">
			<div class="col-md-12">
				<!-- Advance Search -->
				<div class="advance-search"> {% endcomment %}
					
{% comment %} <div class="row">
			<div class="col-md-12">
				<div class="section-title">
				<!-- Secodnary Nav -->
				<nav >
					<a  class="navtwo" href="#" title="Home"><i class="fas fa-map-marker-alt fa-3x"></i> Activities by City</a>
					<a  class="navtwo" href="#" title="Home"><i class="fas fa-futbol fa-3x"></i> Categories</a>
					<a  class="navtwo" href="#" title="About"><i class="fas fa-check fa-3x"></i> Best Reviewd</a>
					<a  class="navtwo" href="#" title="Store"><i class="fas fa-search fa-3x"></i> Search</a>
					</nav>
				</div>
			</div>
		</div> {% endcomment %}
				{% comment %} </div>
			</div>
		</div>
	</div>
</section> {% endcomment %}
<!--===================================
=            Main Section          =
====================================-->
<section class="section bg-gray">
	<!-- Container Start -->
	<div class="container">
		<div class="row">
			<!-- Left sidebar -->
			<div class="col-md-8">
				<div id = "business" data-business-id = "{{ business.pk }}" class="product-details">
					<h1 class="product-title">{{business.name}}</h1>
					<div class="product-meta">
						<ul class="list">
							 <li class="list-inline-item"><i class="fa fa-star" style="color:#FFFF00;"></i> User Score:{{average_score }}</li> 
							
							<li class="list-inline-item"><i class="fas fa-globe-americas" style="color:#0000ff;"></i> Categories:<a href="">{{business.categories}}</a></li>
							<li class="list-inline-item"><i class="fa fa-location-arrow" style="color:#7CFC00;"></i> Location: <a href="">{{business.address}}</a></li>
						</ul>
					</div>
					{% comment %} <div id="carouselExampleIndicators" class="product-slider carousel slide" data-ride="carousel">
						<ol class="carousel-indicators">
							<li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
							<li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
							<li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
						</ol>
						<div class="carousel-inner">
							<div class="carousel-item active">
								<img class="d-block w-100" src="https://i.stack.imgur.com/53eCm.png" height="100" width="100" alt="article-01">
							</div>
							<div class="carousel-item">
								<img class="d-block w-100" src="https://i.stack.imgur.com/53eCm.png" height="100" width="100" alt="article-01">
							</div>
							<div class="carousel-item">
								<img class="d-block w-100" src="https://i.stack.imgur.com/53eCm.png" height="100" width="100" alt="article-01">
						
							</div>
						</div>
						<a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
							<span class="carousel-control-prev-icon" aria-hidden="true"></span>
							<span class="sr-only">Previous</span>
						</a>
						<a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
							<span class="carousel-control-next-icon" aria-hidden="true"></span>
							<span class="sr-only">Next</span>
						</a>
					</div> {% endcomment %}
					<div class="content">
						<ul class="nav nav-pills  justify-content-center" id="pills-tab" role="tablist">
							<li class="nav-item">
								<a class="nav-link active" id="pills-home-tab" data-toggle="pill" href="#pills-home" role="tab" aria-controls="pills-home" aria-selected="true">Reviews</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" id="pills-profile-tab" data-toggle="pill" href="#pills-profile" role="tab" aria-controls="pills-profile" aria-selected="false">Upcoming Events</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" id="pills-contact-tab" data-toggle="pill" href="#pills-contact" role="tab" aria-controls="pills-contact" aria-selected="false">Leave A Review</a>
							</li>
						</ul>
						<div class="tab-content" id="pills-tabContent">
							<div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
								<h3 class="tab-title">Review for {{business.name}}</h3>
								

							<!-- Review For Loop -->
                {% for review in review %}

				<div class="card border-secondary mb-10" style="max-width: 50rem;">
					<div class="card-header">
					<ul class="list">
							
							 <li class="list-inline-item"><i class="fa fa-star" style="color:#FFFF00;"></i> {{ review.rating }} / 5.0 </li> 
							 <li class="list-inline-item"> <b> "Awesome" </b></li> 
							
							{% comment %} <li class="list-inline-item"><i class="fas fa-globe-americas" style="color:#0000ff;"></i> Categories:<a href=""></a></li>
							<li class="list-inline-item"><i class="fa fa-location-arrow" style="color:#7CFC00;"></i> Location: <a href="">/a></li> {% endcomment %}
						</ul>

					</div>
					<div class="card-body text-secondary">

							<li class="list-inline-item"><i class="fas fa-user" style="color:#0000ff;"></i> {{ user }} </li>

						<p class="card-text">"{{ review.text }}"</p>
					</div>
					</div>
					<br> 


                                 {% comment %} Delete Comment Section  {% if user == review.reviewer or user.is_staff %} {% endcomment %}
                                {% comment %} <a class="button" href="{% url 'user_delete_review' id=review.id %}" ><i class="fas fa-trash-alt"></i> &nbsp; Delete</a> {% endcomment %}
                                {% comment %} {% endif %}  {% endcomment %}
                        

                {% endfor %}
								<!-- End Review For Loop -->
								

							</div>
							<div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab">
							
								<h3 class="tab-title">Upcoming Events </h3>

								<!-- Event For Loop -->
								{% for event in events %}

								<div class="media">
									{% if event.image %}
										<img class="mr-3" height="120" width="120" src="{{ event.image.url }}" alt="Generic placeholder image">
									{% else %}
										<img class="mr-3" height="120px" width="120px" src="http://www.firstnonprofit.org/wp-content/uploads/2018/04/YMCA-Camp-Mason_400x400.jpg" alt="Generic placeholder image">
									{% endif %}
								<div class="media-body">
									<h5 class="mt-0"><a href="{% url 'event_detail' slug=event.slug %}">{{event.title}}</h5>
									<ul class="list-inline product-meta">
												<li class="list-inline-item">
													<p> {{event.business}}</p></li>
												<li class="list-inline-item"><i class="fa fa-location-arrow" style="color:#D01C2E;"></i> {{ event.city }}  </li>
												<li class="list-inline-item"><i class="fa fa-calendar" style="color:#009999;" ></i> {{ event.start_date }}  </li>
												<li class="list-inline-item"><i class="fa fa-clock" style="color:#ffbb33;" ></i> {{ event.start_time }} - {{ event.end_time }}   </li>
											</ul>
											<p> {{event.description}}</p> 
											
											<button class="btn "><i style="color:#31B91C;" class="fa fa-reply">  </i><a href="{% url 'event_detail' slug=event.slug %}"> More information  </a></button>
								</div>
								</div>
									<div >
													
													
									</div>
									<br> 
									<br> 

									
        				{% endfor %}
								
							</div>
							<!-- End Event For Loop -->

							




							<div class="tab-pane fade" id="pills-contact" role="tabpanel" aria-labelledby="pills-contact-tab">
							
								<h3 class="tab-title">Leave a review for  {{business.name}}</h3>
								<div class="product-review">
							  		
							  		<div class="review-submission">
							  			
						  				<!-- Rate -->
						  				
						  				<div class="review-submit">
											<!-- Working Form  -->

												<form role="form" action="" method="post" class= "subtitle is-4" >
												{% csrf_token %}
												{{ form.as_p }}
												<br>
												<button type="submit" class = "button hero is-outlined  form-padding">Submit</button>   
													</form> 
													<!-- Non Working Form  -->
						  					{% comment %} <form action="#" class="row">
						  						<div class="col-lg-6">
						  							<input type="text" name="name" id="name" class="form-control" placeholder="Name">
						  						</div>
						  						<div class="col-lg-6">
						  							<input type="email" name="email" id="email" class="form-control" placeholder="Email">
						  						</div>
						  						<div class="col-12">
						  							<textarea name="review" id="review" rows="10" class="form-control" placeholder="Message"></textarea>
						  						</div>
						  						<div class="col-12">
						  							<button type="submit" class="btn btn-main">Sumbit</button>
						  						</div>
						  					</form> {% endcomment %}

						  				</div>
							  		</div>
							  	</div>
							</div>
						</div>




						
					</div>
				</div>
			</div>
			<div class="col-md-4">
				<div class="sidebar">
					
					<!-- User Profile widget -->
					{% if business.image %}
					<div class="widget map" >
					
						<img class="mr-3" height="50" width="75" src="{{ business.image.url }}" alt="Generic placeholder image">

					</div>
					{% else %}
					<div class="widget map" >
					
						<img class="mr-3" height="200px" width="100%" src="http://www.firstnonprofit.org/wp-content/uploads/2018/04/YMCA-Camp-Mason_400x400.jpg" alt="Generic placeholder image">

					</div>
					{% endif %}
					
					<!-- Map Widget -->
					<div id = "map" class="d-block w-100" height="300" width="300">

						
						</div>
					</div>
					<!-- Rate Widget -->
					
					<!-- Safety tips widget -->
					
					<!-- Coupon Widget -->
					<div class="widget coupon text-center">
						<!-- Coupon description -->
						<p>Join our mailing list
						</p>
						<!-- Submii button -->
						<a href="" class="btn btn-transparent-white">Submit </a>
					</div>
					
				</div>
			</div>
			
		</div>
	</div>
	<!-- Container End -->
</section>
<script>

mapboxgl.accessToken = 'pk.eyJ1IjoidHJpYW5nbGU0a2lkcyIsImEiOiJjanFubWRwMGw3a2hjNGFtc3RrMWQ4OXl5In0.eZj0i5qyOBlmeY2oH6LWow';

// TO DO: get ID from HTML 
bizId = 212
$("#business").data("businessId")

// TO DO: call /api/businesseslocation/{pk}
$.getJSON( "ajax/test.json", function( data ) {
  var items = [];
  $.each( data, function( key, val ) {
    items.push( "<li id='" + key + "'>" + val + "</li>" );
  });

// TO DO: get results


// TO DO: parse json results
$.parseJSON()

// TO DO: find businesslatlong matching bizid above


// TO DO: get latlong from matching entry
bizLat = 35.81
bizLong = -78.81

var map = new mapboxgl.Map({
  container: 'map',
  style: 'mapbox://styles/mapbox/light-v9',
  center: [bizLong, bizLat],
  zoom: 7
});

addLatLongMarker(bizLat, bizLong)

function addLatLongMarker(latitude, longitude) {
  // create a HTML element for each feature
  var el = document.createElement('div');
  el.className = 'marker';

  coords= [longitude, latitude]
  // make a marker for each feature and add to the map
  new mapboxgl.Marker(el)
    .setLngLat(coords)
    .addTo(map);
}
</script>

{% endblock content %}

